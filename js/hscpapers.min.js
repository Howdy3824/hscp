var jsonData,courseIndex,yearIndex,docLink,urlCourse,urlYear,urlDoc,selectedCourse,selectedYear,selectedDoc,params;function urlParam(name){var results=new RegExp('[\?&]'+name+'=([^&#]*)').exec(window.location.href);return results===null?'':decodeURIComponent(results[1])}
$(document).ready(function(){urlCourse=urlParam('course');urlYear=urlParam('year');urlDoc=urlParam('doc');if(urlParam('open')=='about')$('#about-modal').modal('show');params={course:'',year:'',doc:''}
$('#more-dropdown').dropdown({action:'nothing'});$.getJSON('https://raw.githubusercontent.com/notseenee/nesappscraper/master/data.json',function(data){jsonData=data;populateDropdown(jsonData,'course_name','#course-menu',!1);$('#course-dropdown').removeClass('loading').dropdown('show').dropdown({selectOnKeydown:!1});if(urlCourse){$('#course-dropdown').dropdown('set selected',urlCourse).dropdown('hide')}});$.getJSON('https://raw.githubusercontent.com/notseenee/nesappscraper/master/meta.json',function(data){console.log(data.timestamp);$('#timestamp').html(data.timestamp.replace('T',' ').substring(0,19))});$('.popup').popup();$('#about-modal').modal({duration:200})});function populateDropdown(searchIn,searchFor,pushTo,reverse){var items=[];for(i=0;i<searchIn.length;i++){items.push(searchIn[i][searchFor])}
items.sort();if(reverse)items.reverse();$(pushTo).empty();for(j=0;j<items.length;j++){$(pushTo).append('<div class="item" data-value"1">'+items[j]+'</div>')}}
$('#course-input').change(function(){selectedCourse=$('#course-input')[0].value;params.course=selectedCourse
$('#year-dropdown').addClass('loading').removeClass('disabled');for(k=0;k<jsonData.length;k++){if(jsonData[k].course_name.toLowerCase()==selectedCourse){courseIndex=k;break}}
populateDropdown(jsonData[courseIndex].packs,'year','#year-menu',!0);$('#year-dropdown').removeClass('loading').dropdown('restore defaults').dropdown('show').dropdown({selectOnKeydown:!1});if(urlYear){$('#year-dropdown').dropdown('set selected',urlYear).dropdown('hide')}
history.pushState(null,'','?'+$.param(params))});$('#year-input').change(function(){if($(this)[0].value=='')return;selectedYear=$('#year-input')[0].value;params.year=selectedYear;$('#doc-dropdown').addClass('loading').removeClass('disabled');for(l=0;l<jsonData[courseIndex].packs.length;l++){if(jsonData[courseIndex].packs[l].year==selectedYear){yearIndex=l;break}}
populateDropdown(jsonData[courseIndex].packs[yearIndex].docs,'doc_name','#doc-menu',!1);$('#doc-dropdown').removeClass('loading').dropdown('restore defaults').dropdown('show');if(urlDoc){$('#doc-dropdown').dropdown('set selected',urlDoc).dropdown('hide')}
$('.button-exampack').removeClass('disabled').attr('href',jsonData[courseIndex].packs[yearIndex].link);history.pushState(null,'','?'+$.param(params))});$('#doc-input').change(function(){if($(this)[0].value=='')return;selectedDoc=$('#doc-input')[0].value;params.doc=selectedDoc;for(m=0;m<jsonData[courseIndex].packs[yearIndex].docs.length;m++){if(jsonData[courseIndex].packs[yearIndex].docs[m].doc_name.toLowerCase()==selectedDoc){docLink=jsonData[courseIndex].packs[yearIndex].docs[m].doc_link;docLink=docLink.replace('http','https');break}}
$('#iframe').attr('src',docLink);$('#iframe-loader').addClass('active');$('.button-download').removeClass('disabled').attr('href',docLink);$('.button-link').removeClass('disabled').removeAttr('disabled');history.pushState(null,'','?'+$.param(params));document.title=$('#year-dropdown .text').html()+' '+$('#doc-dropdown .text').html()+' - '+$('#course-dropdown .text').html()});$('.button-link').click(function(){prompt('Copy link below:',docLink)});$('.button-about').click(function(){$('#about-modal').modal('show')});$('#iframe').on('load',function(){$('#iframe-loader').removeClass('active')})
